<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NPS Retirement Income Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: linear-gradient(120deg, #e0eafc, #cfdef3 100%);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      max-width: 700px;
      margin: 40px auto;
      padding: 32px 28px 28px 28px;
      border-radius: 18px;
      box-shadow: 0 6px 32px rgba(0,0,0,0.08);
    }
    h1 {
      text-align: center;
      color: #1a237e;
      margin-bottom: 18px;
      letter-spacing: 1px;
    }
    .form-group {
      margin-bottom: 16px;
    }
    label {
      display: block;
      margin-bottom: 4px;
      color: #333;
      font-weight: 500;
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      width: 100%;
      padding: 7px 10px;
      border: 1px solid #b0bec5;
      border-radius: 4px;
      font-size: 1rem;
      background: #f6f8fa;
      transition: border-color 0.2s;
      appearance: textfield;
      -moz-appearance: textfield;
    }
    input[type="number"]:focus {
      border-color: #3949ab;
      outline: none;
    }
    .desc {
      font-size: 0.92em;
      color: #607d8b;
      margin-bottom: 8px;
      margin-top: 2px;
    }
    .goal-seek {
      margin: 18px 0 12px 0;
      padding: 14px 18px;
      background: #e3f2fd;
      border-radius: 8px;
      color: #1976d2;
      font-weight: 500;
    }
    .output {
      margin-top: 32px;
      background: #f1f8e9;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 8px #dcedc8;
    }
    .output h2 {
      margin-top: 0;
      color: #2e7d32;
      font-size: 1.2em;
    }
    .output-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 1.04em;
    }
    .output-table th, .output-table td {
      padding: 7px 7px;
      border-bottom: 1px solid #e0e0e0;
    }
    .output-table th {
      background: #e3f2fd;
      text-align: left;
      color: #1976d2;
      font-weight: bold;
    }
    .output-table td.value {
      text-align: right;
      color: #1976d2;
      font-weight: bold;
    }
    .flash-yes {
      animation: flash-green 1.2s infinite alternate;
      background: #c8e6c9;
      color: #1b5e20 !important;
      font-weight: bold;
      font-size: 1.1em;
      border-radius: 5px;
      text-align: center;
    }
    .flash-no {
      animation: flash-red 1.2s infinite alternate;
      background: #ffcdd2;
      color: #b71c1c !important;
      font-weight: bold;
      font-size: 1.1em;
      border-radius: 5px;
      text-align: center;
    }
    @keyframes flash-green {
      0% { box-shadow: 0 0 0px #43a047; }
      100% { box-shadow: 0 0 16px #43a047; }
    }
    @keyframes flash-red {
      0% { box-shadow: 0 0 0px #e53935; }
      100% { box-shadow: 0 0 16px #e53935; }
    }
    .gap-info {
      margin-top: 12px;
      padding: 10px;
      border-radius: 6px;
      font-size: 1.07em;
      background: #fff3e0;
      color: #ff6f00;
      border: 1px solid #ffe0b2;
      text-align: center;
      font-weight: 500;
    }
    .gap-info.positive {
      background: #e8f5e9;
      color: #388e3c;
      border: 1px solid #a5d6a7;
    }
    .tax-info {
      margin-top: 16px;
      padding: 10px;
      border-radius: 6px;
      background: #e3f2fd;
      color: #1976d2;
      border: 1px solid #bbdefb;
      text-align: center;
      font-size: 1em;
    }
    .sensitivity {
      margin-top: 18px;
      padding: 12px;
      background: #fffde7;
      color: #ff8f00;
      border-radius: 8px;
      font-size: 0.99em;
      border: 1px solid #ffe082;
    }
    .education-section {
      margin-top: 28px;
      background: #f9fbe7;
      border-radius: 8px;
      padding: 14px 18px;
      color: #616161;
      font-size: 1em;
      border: 1px solid #e6ee9c;
    }
    .education-section summary {
      font-weight: bold;
      color: #827717;
      cursor: pointer;
      font-size: 1.07em;
      margin-bottom: 8px;
    }
    @media (max-width: 700px) {
      .container { padding: 13px 4vw 20px 4vw; }
      h1 { font-size: 1.3em; }
      .output-table th, .output-table td { font-size: 0.93em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>NPS Retirement Income Calculator</h1>
    <form id="npsForm" autocomplete="off">
      <div class="goal-seek">
        <label for="goalSeek">🎯 Want a specific NPS monthly income at retirement?</label>
        <input type="number" id="goalSeek" placeholder="Enter your desired monthly NPS income (optional)" style="width:100%;margin-top:6px;">
        <div class="desc">Enter your target NPS monthly income at retirement. The calculator will show the required monthly contribution.</div>
      </div>
      <div class="form-group">
        <label for="currentAge">Current Age</label>
        <input type="number" id="currentAge" value="40" min="18" max="80" required>
        <div class="desc">Your current age in years</div>
      </div>
      <div class="form-group">
        <label for="retirementAge">Retirement Age</label>
        <input type="number" id="retirementAge" value="60" min="18" max="80" required>
        <div class="desc">Age when you plan to retire</div>
      </div>
      <div class="form-group">
        <label for="currentNPSBalance">Current NPS Balance (₹)</label>
        <input type="number" id="currentNPSBalance" value="900000" min="0" step="any" required>
        <div class="desc">Total amount in your NPS account now</div>
      </div>
      <div class="form-group">
        <label for="monthlyContribution">Monthly NPS Contribution (₹)</label>
        <input type="number" id="monthlyContribution" value="22000" min="0" step="any" required>
        <div class="desc">Your monthly NPS contribution</div>
      </div>
      <div class="form-group">
        <label for="monthlyExpense">Current Monthly Expense (₹)</label>
        <input type="number" id="monthlyExpense" value="60000" min="0" step="any" required>
        <div class="desc">Your current monthly living expenses</div>
      </div>
      <div class="form-group">
        <label for="inflationRate">Inflation Rate (%)</label>
        <input type="number" id="inflationRate" value="4" min="0" max="100" step="any" required>
        <div class="desc">Latest annual inflation rate in India is 3.16% (Apr 2025). 5-year average is ~4%. [Source: Trading Economics, MoSPI]</div>
      </div>
      <div class="form-group">
        <label for="npsTarget">NPS Target % of Expense</label>
        <input type="number" id="npsTarget" value="30" min="0" max="100" step="any" required>
        <div class="desc">Percent of retirement expense you want NPS to cover</div>
      </div>
      <div class="form-group">
        <label for="equityReturn">Equity Return (%)</label>
        <input type="number" id="equityReturn" value="12" min="0" max="100" step="any" required>
        <div class="desc">Scheme E (Equity): 5-year average annual return is 11–14%. [Source: NPS Trust, 2025]</div>
      </div>
      <div class="form-group">
        <label for="corporateBondReturn">Corporate Bond Return (%)</label>
        <input type="number" id="corporateBondReturn" value="8" min="0" max="100" step="any" required>
        <div class="desc">Scheme C (Corporate Bonds): 5-year average annual return is 7–9%. [Source: NPS Trust, 2025]</div>
      </div>
      <div class="form-group">
        <label for="governmentBondReturn">Government Bond Return (%)</label>
        <input type="number" id="governmentBondReturn" value="7" min="0" max="100" step="any" required>
        <div class="desc">Scheme G (Government Securities): 5-year average annual return is 6–7.5%. [Source: NPS Trust, 2025]</div>
      </div>
      <div class="form-group">
        <label for="equityAllocation">Equity Allocation (%)</label>
        <input type="number" id="equityAllocation" value="75" min="0" max="100" step="any" required>
        <div class="desc">Percent of NPS in equity (Scheme E)</div>
      </div>
      <div class="form-group">
        <label for="corporateAllocation">Corporate Allocation (%)</label>
        <input type="number" id="corporateAllocation" value="20" min="0" max="100" step="any" required>
        <div class="desc">Percent of NPS in corporate bonds (Scheme C)</div>
      </div>
      <div class="form-group">
        <label for="governmentAllocation">Government Allocation (%)</label>
        <input type="number" id="governmentAllocation" value="5" min="0" max="100" step="any" required>
        <div class="desc">Percent of NPS in government securities (Scheme G)</div>
      </div>
      <div class="form-group">
        <label for="swpReturn">SWP Return (%)</label>
        <input type="number" id="swpReturn" value="9" min="0" max="100" step="any" required>
        <div class="desc">Average 5-year return for SWP (hybrid/balanced funds) is 8–10%. [Source: Mutual fund data, 2025]</div>
      </div>
      <div class="form-group">
        <label for="swpWithdrawalRate">SWP Withdrawal Rate (%)</label>
        <input type="number" id="swpWithdrawalRate" value="4" min="0" max="100" step="any" required>
        <div class="desc">Annual withdrawal rate from SWP corpus</div>
      </div>
      <div class="form-group">
        <label for="annuityReturn">Annuity Return (%)</label>
        <input type="number" id="annuityReturn" value="6" min="0" max="100" step="any" required>
        <div class="desc">Current annuity rates in India are 5–6.5%. [Source: LIC, HDFC, SBI Life, 2025]</div>
      </div>
      <button type="submit">Calculate</button>
    </form>
    <div class="output" id="output"></div>
    <div class="education-section">
      <details>
        <summary>ℹ️ About NPS, SWP, and Annuity (Click to expand)</summary>
        <ul>
          <li><b>NPS Withdrawal:</b> At retirement, you can withdraw up to 60% of your corpus as a lump sum (tax-free), and at least 40% must be used to buy an annuity (regular pension).</li>
          <li><b>Scheme E/C/G:</b> NPS lets you choose your asset allocation between Equity (E), Corporate Bonds (C), and Government Securities (G).</li>
          <li><b>SWP:</b> Systematic Withdrawal Plan lets you withdraw a fixed amount from your lump sum corpus monthly.</li>
          <li><b>Annuity:</b> The annuity provider pays a fixed monthly pension for life. Rates depend on age, provider, and option chosen (single/joint, with/without return of purchase price).</li>
          <li><b>Tax Benefits:</b> NPS contributions are eligible for tax deduction under Sec 80C (up to ₹1.5 lakh) and Sec 80CCD(1B) (additional ₹50,000).</li>
          <li><b>Risks:</b> Returns are market-linked and not guaranteed. Inflation and longevity risk should be considered.</li>
        </ul>
      </details>
    </div>
  </div>
  <script>
    function toCurrency(n) {
      return "₹ " + n.toLocaleString('en-IN', {maximumFractionDigits: 0});
    }
    document.getElementById('npsForm').addEventListener('submit', function(e) {
      e.preventDefault();

      // Inputs
      const currentAge = Number(document.getElementById('currentAge').value);
      const retirementAge = Number(document.getElementById('retirementAge').value);
      const currentNPSBalance = Number(document.getElementById('currentNPSBalance').value);
      const monthlyContribution = Number(document.getElementById('monthlyContribution').value);
      const monthlyExpense = Number(document.getElementById('monthlyExpense').value);
      const inflationRate = Number(document.getElementById('inflationRate').value) / 100;
      const npsTarget = Number(document.getElementById('npsTarget').value) / 100;
      const equityReturn = Number(document.getElementById('equityReturn').value) / 100;
      const corporateBondReturn = Number(document.getElementById('corporateBondReturn').value) / 100;
      const governmentBondReturn = Number(document.getElementById('governmentBondReturn').value) / 100;
      const equityAllocation = Number(document.getElementById('equityAllocation').value) / 100;
      const corporateAllocation = Number(document.getElementById('corporateAllocation').value) / 100;
      const governmentAllocation = Number(document.getElementById('governmentAllocation').value) / 100;
      const swpReturn = Number(document.getElementById('swpReturn').value) / 100;
      const swpWithdrawalRate = Number(document.getElementById('swpWithdrawalRate').value) / 100;
      const annuityReturn = Number(document.getElementById('annuityReturn').value) / 100;
      const goalSeekValue = Number(document.getElementById('goalSeek').value);

      // Calculations
      const yearsToRetirement = retirementAge - currentAge;
      const monthsToRetirement = yearsToRetirement * 12;

      // Blended Return
      const blendedReturn = 
        equityReturn * equityAllocation +
        corporateBondReturn * corporateAllocation +
        governmentBondReturn * governmentAllocation;

      // Monthly Return
      const monthlyReturn = Math.pow(1 + blendedReturn, 1/12) - 1;

      // FV of current corpus
      const fvCurrentCorpus = currentNPSBalance * Math.pow(1 + monthlyReturn, monthsToRetirement);

      // FV of monthly contributions (ordinary annuity, no escalation)
      const fvContributions = monthlyContribution * (Math.pow(1 + monthlyReturn, monthsToRetirement) - 1) / monthlyReturn;

      // Total NPS corpus
      const totalNPSCorpus = fvCurrentCorpus + fvContributions;

      // SWP/Annuity corpus
      const swpCorpus = totalNPSCorpus * 0.6;
      const annuityCorpus = totalNPSCorpus * 0.4;

      // Monthly SWP income
      const monthlySWPIncome = swpCorpus * (swpWithdrawalRate/12);

      // Monthly Annuity income
      const monthlyAnnuityIncome = annuityCorpus * (annuityReturn/12);

      // Total Monthly NPS Income
      const totalMonthlyNPSIncome = monthlySWPIncome + monthlyAnnuityIncome;

      // Inflation Adjusted Expense
      const inflationAdjustedExpense = monthlyExpense * Math.pow(1 + inflationRate, yearsToRetirement);

      // Target Monthly Income from NPS
      const targetMonthlyNPSIncome = npsTarget * inflationAdjustedExpense;

      // Is Contribution Enough?
      const isEnough = totalMonthlyNPSIncome >= targetMonthlyNPSIncome ? "Yes" : "No";

      // Calculate monthly contribution gap
      let neededMonthlyContribution = 0;
      if (totalMonthlyNPSIncome < targetMonthlyNPSIncome) {
        // Estimate extra monthly contribution needed
        const corpusNeeded = targetMonthlyNPSIncome / ((0.6 * swpWithdrawalRate / 12) + (0.4 * annuityReturn / 12));
        const extraCorpusNeeded = corpusNeeded - totalNPSCorpus;
        if (extraCorpusNeeded > 0) {
          neededMonthlyContribution = extraCorpusNeeded * monthlyReturn / (Math.pow(1 + monthlyReturn, monthsToRetirement) - 1);
        }
      } else {
        // Surplus income per month
        neededMonthlyContribution = totalMonthlyNPSIncome - targetMonthlyNPSIncome;
      }

      // Goal Seek: If user entered a target NPS income, calculate required monthly contribution
      let goalSeekResult = '';
      if (goalSeekValue && goalSeekValue > 0) {
        const requiredCorpus = goalSeekValue / ((0.6 * swpWithdrawalRate / 12) + (0.4 * annuityReturn / 12));
        const requiredFV = requiredCorpus - fvCurrentCorpus;
        let reqContribution = 0;
        if (requiredFV > 0) {
          reqContribution = requiredFV * monthlyReturn / (Math.pow(1 + monthlyReturn, monthsToRetirement) - 1);
        }
        goalSeekResult = `<div class="goal-seek" style="background:#fffde7;color:#ff8f00;">
          To get <b>${toCurrency(goalSeekValue)}</b> per month from NPS at retirement, you need to contribute <b>${toCurrency(Math.ceil(reqContribution))}</b> per month.
        </div>`;
      }

      // Tax benefit estimation (80C + 80CCD(1B))
      let taxBenefit = 0;
      let eligible80C = Math.min(monthlyContribution * 12, 150000);
      let eligible80CCD1B = Math.min(Math.max(monthlyContribution * 12 - 150000, 0), 50000);
      taxBenefit = eligible80C + eligible80CCD1B;
      let taxInfo = `<div class="tax-info">
        Estimated annual tax deduction for your NPS contribution: <b>${toCurrency(taxBenefit)}</b> (Sec 80C + 80CCD(1B))
      </div>`;

      // Sensitivity analysis: +1%/-1% inflation and returns
      function sensitivity(inflationAdj, blendedAdj) {
        const infAdj = inflationRate + inflationAdj;
        const blendAdj = blendedReturn + blendedAdj;
        const monAdj = Math.pow(1 + blendAdj, 1/12) - 1;
        const fvCurrentAdj = currentNPSBalance * Math.pow(1 + monAdj, monthsToRetirement);
        const fvContrAdj = monthlyContribution * (Math.pow(1 + monAdj, monthsToRetirement) - 1) / monAdj;
        const totalCorpusAdj = fvCurrentAdj + fvContrAdj;
        const swpCorpusAdj = totalCorpusAdj * 0.6;
        const annuityCorpusAdj = totalCorpusAdj * 0.4;
        const monthlySWPAdj = swpCorpusAdj * (swpWithdrawalRate/12);
        const monthlyAnnuityAdj = annuityCorpusAdj * (annuityReturn/12);
        const totalNPSIncomeAdj = monthlySWPAdj + monthlyAnnuityAdj;
        const inflationExpenseAdj = monthlyExpense * Math.pow(1 + infAdj, yearsToRetirement);
        const targetNPSIncomeAdj = npsTarget * inflationExpenseAdj;
        return {
          totalNPSIncomeAdj,
          targetNPSIncomeAdj
        };
      }
      const sensPlus = sensitivity(0.01, 0.01);
      const sensMinus = sensitivity(-0.01, -0.01);

      let sensitivityHtml = `
        <div class="sensitivity">
          <b>Sensitivity Analysis:</b><br>
          <span style="color:#388e3c;">If inflation and returns are <b>1% higher</b>:</span>
          <br>Projected NPS income: <b>${toCurrency(Math.round(sensPlus.totalNPSIncomeAdj))}</b> | Target: <b>${toCurrency(Math.round(sensPlus.targetNPSIncomeAdj))}</b>
          <br>
          <span style="color:#d84315;">If inflation and returns are <b>1% lower</b>:</span>
          <br>Projected NPS income: <b>${toCurrency(Math.round(sensMinus.totalNPSIncomeAdj))}</b> | Target: <b>${toCurrency(Math.round(sensMinus.targetNPSIncomeAdj))}</b>
        </div>
      `;

      // Output Table
      document.getElementById('output').innerHTML = `
        <h2>Will NPS Meet My Retirement Income Needs?</h2>
        <table class="output-table">
          <tr>
            <th>Metric</th>
            <th>Value</th>
          </tr>
          <tr>
            <td>Years to Retirement</td>
            <td class="value">${yearsToRetirement}</td>
          </tr>
          <tr>
            <td>Blended Return (annual)</td>
            <td class="value">${(blendedReturn*100).toFixed(2)}%</td>
          </tr>
          <tr>
            <td>Projected NPS Corpus at Retirement</td>
            <td class="value">${toCurrency(Math.round(totalNPSCorpus))}</td>
          </tr>
          <tr>
            <td>Projected Monthly NPS Income</td>
            <td class="value">${toCurrency(Math.round(totalMonthlyNPSIncome))}</td>
          </tr>
          <tr>
            <td>Inflation-Adjusted Retirement Expense</td>
            <td class="value">${toCurrency(Math.round(inflationAdjustedExpense))}</td>
          </tr>
          <tr>
            <td>Target NPS Income (${(npsTarget*100).toFixed(0)}% of expense)</td>
            <td class="value">${toCurrency(Math.round(targetMonthlyNPSIncome))}</td>
          </tr>
          <tr>
            <td>Is Contribution Enough?</td>
            <td class="value ${isEnough === "Yes" ? "flash-yes" : "flash-no"}">${isEnough}</td>
          </tr>
        </table>
        ${
          isEnough === "No"
          ? `<div class="gap-info">
                You need to increase your monthly contribution by <b>${toCurrency(Math.round(neededMonthlyContribution))}</b> to meet your target.
             </div>`
          : `<div class="gap-info positive">
                You have a surplus of <b>${toCurrency(Math.round(neededMonthlyContribution))}</b> per month above your target!
             </div>`
        }
        ${goalSeekResult}
        ${taxInfo}
        ${sensitivityHtml}
        <div style="margin-top:8px;color:#888;font-size:0.98em;">
          <b>Note:</b> These are estimates based on latest 5-year averages (2020–2025). Please consult a financial advisor before making investment decisions.
        </div>
      `;
    });
  </script>
</body>
</html>
